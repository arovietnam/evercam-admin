<div class="bb-alert alert" style="display: none;"></div>
<img src="<%= image_path 'loading.gif' %>" id="api-wait" style="display:none" />
<!-- BEGIN CONTENT -->
<div class="page-content-wrapper">
  <div class="page-content" id="snapshots-report">
    <!-- BEGIN PAGE HEADER-->
    <div class="row overlop-margin">
      <div class="dropdown-checklist" id="div-dropdown-checklist">
        <div href="#" class="btn btn-default grey" data-toggle="modal" data-target="#toggle-datatable-columns">
          <i class="fa fa-columns"></i>
        </div>
      </div>
    </div>
    <!-- END PAGE HEADER-->
    <!-- BEGIN PAGE CONTENT-->
    <div class="row overlapping">
      <div class="form-mains">
        <div class="main-contains">
          <div class="filter-naming">
            Search :
          </div>
          <div class="inputs-divs">
            <input type="text" class="first-inps" placeholder="Search Camera" id="camera-name">
            <input type="text" class="first-inps" placeholder="Search Onwer" id="owner">
            <input type="text" class="first-inps" placeholder="Search Status" id="status">
            <input type="text" class="first-inps" placeholder="Search Duration" id="duration">
            <input type="text" class="first-inps" placeholder="Search Online" id="online">
          </div>
        </div>
      </div>
    </div>
    <%= render 'columns_modal' %>
    <div id="snapshots-list-row" class="row hide dt-user-m snapshots-list-row">
      <div class="col-md-12 filter-top">
        <table class="table table-striped table-bordered table-hover snapshots-datatables" id="snapshots_datatables">
          <thead>
          <tr role="row" class="heading">
            <th name="order_name" class="sorting">Name</th>
            <th name="order_owner" class="sorting">Owner</th>
            <th name="order_count" class="sorting">Count</th>
            <th name="order_oldest_snapshot" class="sorting">Oldest Snapshot</th>
            <th name="order_cr_status" class="sorting">Status</th>
            <th name="order_cr_duration" class="sorting">Duration</th>
            <th name="order_cr_interval" class="sorting">Interval # / min</th>
            <th name="order_cr_schedule_hpw" class="sorting">Schedule HPW</th>
            <th name="order_new_60min" class="sorting">New in last 60min</th>
            <th name="order_cam_status" class="sorting">Online</th>
            <th name="order_cam_exid" class="sorting">Camera Id</th>
            <th name="order_cam_user_id" class="sorting">User Id</th>
            <th name="order_cam_thumbail" class="sorting">Thumbnail</th>
            <th name="order_cam_licenced" class="sorting">Licenced</th>
          </tr>
          </thead>
          <tbody>
          <% @cameras.each do |camera| %>
            <% if camera.cloud_recording && camera.cloud_recording.status != "off" %>
              <tr>
                <td><%= link_to camera.name, camera_path(camera) %></td>
                <td>
                  <div class='link-user'>
                    <%= link_to camera.user.fullname, user_path(camera.user), class: "pull-left" %>
                    <a class='pull-right u-dash' href='<%= check_env %>/v1/cameras?api_id=<%= camera.user.api_id %>&api_key=<%= camera.user.api_key %>' target='_blank'><i class='fa fa-external-link'></i></a>
                    <a tooltip='Intercom Conversation' class='pull-right open-intercom' data-username="<%= camera.user.username %>"><i class='fa fa-comment-o'></i></a>
                  </div>
                </td>
                <td>0</td>
                <td></td>
                <td>
                  <% if camera.cloud_recording %>
                    <%= camera.cloud_recording.status.titleize %>
                  <% end %>
                </td>
                <td>
                  <% if camera.cloud_recording %>
                    <% if camera.cloud_recording.storage_duration.equal?(-1) %>
                      Infinity
                    <% elsif camera.cloud_recording.storage_duration.equal?(1) %>
                        24
                    <% else %>
                      <%= camera.cloud_recording.storage_duration %>
                    <% end %>
                  <% end %>
                </td>
                <td>
                  <% if camera.cloud_recording %>
                    <% case camera.cloud_recording.frequency
                         when 60 %>
                          60
                    <%   when 30 %>
                          30
                    <%   when 12 %>
                          12
                    <%   when 6 %>
                          6
                    <%   when 1 %>
                          1
                    <%   end %>
                  <% end %>
                </td>
                <td>
                  <% if camera.cloud_recording %>
                    <% unless raw(camera.cloud_recording.schedule.to_json).eql?({"Monday":["0:0-23:59"],"Tuesday":["0:0-23:59"],"Wednesday":["0:0-23:59"],"Thursday":["0:0-23:59"],"Friday":["0:0-23:59"],"Saturday":["0:0-23:59"],"Sunday":["0:0-23:59"]}) %>
                      <% schedule = camera.cloud_recording.schedule %>
                      <%= get_hours(schedule) %>
                    <% end %>
                  <% end %>
                </td>
                <td></td>
                <td> <%= camera.is_online %> </td>
                <td> <%= camera.exid %> </td>
                <td> <%= camera.user.id %> </td>
                <td>
                  <% if camera.is_public %>
                    <img src="https://media.evercam.io/v1/cameras/<%= camera.exid %>/thumbnail?" height="32">
                  <% else %>
                    <img src="https://media.evercam.io/v1/cameras/<%= camera.exid %>/thumbnail?api_id=<%= camera.user.api_id %>&api_key=<%= camera.user.api_key %>" height="32">
                  <% end %>
                </td>
                <td>0</td>
              </tr>
            <% end %>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <!-- END PAGE CONTENT-->
  </div>
</div>
<!-- END CONTENT -->

<script>
  $(document).ready(function () {
    window.initializSnapshots();
  });
</script>
